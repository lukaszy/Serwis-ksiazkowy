
@model SerwisKsiazkowy.ViewModels.DetailsViewModels

@{
    //@ViewBag.Title;
    Layout = "~/Views/Shared/_BookLayout.cshtml";
}

<div class="site">

    <div class="row">

        <div role="tabpanel" class="down">

            @Html.MvcSiteMap().SiteMapPath("BootstrapSiteMapPathHelperModel")
            <div id="book-right">

                @foreach (var book in Model.SelectedBook)
                {
                    <section id="book-details-section">
                        <div id="book-details-left">

                            <img src="@Url.Content("~/Content/Covers/" + book.CoverFileName)" />

                        </div>

                        <div id="book-details-right">
                            <div id="book-details-names">

                                <h1>
                                    @book.Title
                                </h1>
                                <br />
                                <h2>
                                    Autor: @book.Author
                                </h2>

                            </div>

                            <div id="book-details-names">


                                <h2>
                                    Wydawnictwo: @book.Publisher
                                </h2>


                                <h2>
                                    Gatunek: @book.Genre.Name

                                </h2>
                                <h2>
                                    Liczba stron: @book.Pages
                                </h2>
                                <h2>
                                    Data premiery: @book.YearPublished.ToShortDateString()
                                </h2>
                                <h2>
                                    Ocena:
                                    @*@book.AvgRating*@
                                    @if (book.AvgRating == 0)
                                    {
                                        <span>Brak</span>
                                    }
                                    else
                                    {
                                        <span>@book.AvgRating / 10</span>
                                    }


                                </h2>
                                <h2>


                                    Moja ocena:
                                    @if (Model.UserRate.Count() > 0)
                                    {
                                        @Model.UserRate.Select(r => r.Value).Single()


                                    }
                                    else if (User.Identity.IsAuthenticated)
                                    {
                                        @Html.Label("Brak oceny")
                                        using (@Html.BeginForm("AddRate", "Book", FormMethod.Post))
                                        {
                                            @Html.AntiForgeryToken()

                                            @Html.HiddenFor(m => m.NewRate.BookId)

                                            @*@Html.DisplayFor(model => model.NewComment.BookId)*@
                                            @Html.DropDownListFor(m => m.NewRate.Value, new SelectList(Model.ValueRate), "Wybierz ocene")

                                            <input type="submit" value="Dodaj ocene" class="btn btn-default" />

                                        }

                                    }

                                </h2>



                            </div>
                        </div>
                        <div id="book-details-description">
                            <h1>
                                Opis książki
                            </h1>
                            <hr class="style1">
                            @book.Description
                            <hr class="style2">
                        </div>
                        <h2>
                            Recenzje (@ViewBag.countReviews)

                        </h2>
                        <hr class="style1">
                        <div id="book-details-comments">
                            @if (ViewBag.isUser)
                            {

                                if (Model.userReview == null)
                                {
                                    <button type="button" class="btn btn-primary" onclick="location.href='@Url.Action("Index", "Review", new { bookId = book.BookId, bookTitle = book.Title.Replace(" ", "-").ToLower().ToString() }) '">
                                        Dodaj recenzje
                                    </button>
                                }
                                else
                                {
                                    <button type="button" class="btn btn-primary" onclick="location.href='@Url.Action("Edit", "Review", new { reviewId = Model.userReview.ReviewId, bookTitle = book.Title.Replace(" ", "-").ToLower().ToString() }) '">
                                        Edytuj recenzje
                                    </button>


                                }
                            }
                            <button type="button" class="btn btn-primary btn-large" onclick="location.href='@Url.Action("ListReviews", "Review", new { id = book.BookId,  _title = book.Title.Replace(" ", "-").ToLower().ToString() })'">
                                zobacz wszytskie recenzje
                            </button>

                            @Html.Partial("ListReview", Model.Reviews)
                        </div>

                        <h2>

                            Komentarze

                        </h2>
                        <hr class="style1">
                        <p>
                            @if (ViewBag.isUser)
                            {

                                <a class="btn btn-primary" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
                                    Dodaj komentarz
                                </a>
                            }

                            <button type="button" class="btn btn-primary btn-large" onclick="location.href='@Url.Action("GetAllComments", "Comment", new { bookId = book.BookId})'">
                                zobacz wszystkie komentarze
                            </button>

                        </p>
                        <div class="collapse" id="collapseExample">



                            @using (Ajax.BeginForm("Add", "Comment", new { bookId = book.BookId, bookTitle = book.Title.Replace(" ", "-").ToLower().ToString() }, new AjaxOptions { HttpMethod = "POST", UpdateTargetId = "RefreshComment", InsertionMode = InsertionMode.Replace }))
                            {
                                @Html.AntiForgeryToken()
                                @*@Html.ValidationSummary(false, "", new { @class = "text-danger" })*@
                                                                
                                @Html.HiddenFor(model => model.NewComment.BookId)

                                <div class="form-group">
                                    @Html.TextAreaFor(model => model.NewComment.Content, new { @class = "form-control", rows = "5", @placeholder = "Wprowadź tekst.." })
                                    @Html.ValidationMessageFor(model => model.NewComment.Content, "", new { @class = "text-danger" })

                                </div>
                                <input type="submit" value="Dodaj komentarz" class="btn btn-default" />
                            }
                        </div>


                        <div id="RefreshComment">
                            @Html.Action("GetComments", "Comment", new { bookId = book.BookId })
                        </div>

                        <button type="button" class="btn btn-primary btn-large" onclick="location.href='@Url.Action("GetAllComments", "Comment", new { bookId = book.BookId})'">
                            zobacz wszystkie komentarze
                        </button>

                    </section>
                }
            </div>

        </div>
    </div>

</div>


@section scripts{

    <script src="~/Scripts/jquery-3.3.1.js"></script>
    <script src="~/Scripts/jquery.validate.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.js"></script>
    <script src="~/Scripts/handlebars.js"></script>

    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>






}
